#!/bin/sh
set -e

base_name=$(basename $0 | sed 's|-| |')
base_dir=$(dirname $0)
tear_dir=${TEARDIR:="~/.tear"}
active_dir=$tear_dir/active

function die() {
	echo "fatal: $1" >&2
	exit 1
}

function cmdify() {
	echo "$(basename $cmd | sed 's|tear-||')"
}

function tildify() {
	echo $(echo $1 | sed "s|$HOME|~|")
}

function see_usage() {
	[ -n "$1" ] && echo "!! $1" >&2 && echo >&2
	echo "$(usage $0)" >&2
	exit 1
}

function usage() {
	prog='
		BEGIN { inusage=0 }
		/^# USAGE/ { inusage=1; next }
		/^[^#]/    { {if(inusage=1) exit;} }
		/^# (.*)/  { {if(inusage=1) print substr($0, 3)} }
		/^#\s*$/   { {if(inusage=1) print ""} }
	'
	raw=$(awk "$prog" $1)
	echo "Usage: $base_name $raw"
	[ -n "$USAGE2" ] && echo && echo "$USAGE2"
}

function desc() {
	usage $1 | head -n2 | tail -n1
}

function mkcd() {
	mkdir -p $1
	cd $1
}

function env() {
	if test -L $tear_dir/active; then
		echo $(readlink $tear_dir/active) | awk -F/ '{ print $NF }'
	else
		die "$tear_dir/active doesn't exist. run see \`tear help init\`"
	fi
}

# vim: syn=sh
