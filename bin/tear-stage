#!/bin/sh
# USAGE
# <env> <package> <version>
# Stages <package-long> in <env>
#
#   -h, --help            show this message

. $(dirname $0)/tear-common

while [ $# -gt 0 ]; do
case "$1" in
	-h|--help)
		see_usage
		;;
	-*)
		see_usage "unknown option $1"
		;;
	*)
		break
		;;
esac
done

[ $# -lt 3 ] && see_usage "missing arguments"

env=$1
pkg=$2
ver=$3

###
# Perform all work in env
cd $tear_dir/env/$env

if ! test -L packages/$pkg-$ver; then
	warn "Staging $pkg-$ver $env"
	rm -f active/$pkg
	ln -s packages/$pkg-$ver active/$pkg
else
	die "unknown package $pkg-$ver"
fi
