#!/bin/sh
# USAGE
# <package>
# Installs a package into an environment
#
#   -e, --env <name>      environment to work on (default is `tear env`)
#   -h, --help            show this message
#
# Arguments
#
#   <package>   is a git-url

. $(dirname $0)/tear-common

env=$(_env)
while [ $# -gt 0 ]; do
	case "$1" in
		-e|--env)
			test $# -lt 2 && see_usage "missing argument for $1"
			env=$2
			shift; shift
			;;
		-h|--help)
			see_usage
			;;
		*)
			break
			;;
	esac
done

test $# -eq 0 && see_usage

pkg=$1
activedir="$tear_dir/$env/staged/$pkg"

if test -L $activedir; then 
	targetdir=$(readlink -n $activedir)
	test ! -L $targetdir && die "$targetdir is not a directory"

	for dir in "bin lib"; do
		for file in $(ls $targetdir/$dir); do
			rm -f "$activedir/$dir/$file"
			warn "successfully uninstalled $pkg from $env"
		done
	done
else
	die "unable to find package $pkg in $env"
fi
